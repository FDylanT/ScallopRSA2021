---
title: "OctCruiseChemistry"
author: "Dylan Titmuss"
date: "3/15/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

This script visualizes the chemistry data from the October RSA cruise.
Run chunks 1-7 of `chemistry_Oct.Rmd` to load data.

## Load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, root.dir = "./Repos/ScallopRSA2021")

library(tidyverse)
library(sf)
library(nngeo)
library(marmap)
library(cowplot)
library(viridis)
library(pals)
library(rcartocolor)
library(Redmonder)
library(colorspace)
```

## Load GB shapefiles
```{r}
GB <- st_read("./data/2020SAMZones/GB_Estimation_Areas_2019_UTM19_PDT_SFModified.shp")

# subset shapefile to SAMs
NLS_North <- subset(GB, NewSAMS == "NLS-North") %>%
  fortify()
CL1_South <- subset(GB, NewSAMS == "CL1-South") %>%
  fortify()
CL1_Sliver <- subset(GB, NewSAMS == "CL1-Sliver") %>%
  fortify()
CL2_AccessSoutheast <- subset(GB, NewSAMS == "CL2-Access-Southeast") %>%
  fortify()
SF <- subset(GB, NewSAMS == "SF") %>%
  fortify()
CL2_North <- subset(GB, NewSAMS == "CL2-North") %>%
  fortify()
CL1_Access <- subset(GB, NewSAMS == "CL1-Access") %>%
  fortify()
NF <- subset(GB, NewSAMS == "NF") %>%
  fortify()
CL2_Ext <- subset(GB, NewSAMS == "CL2-Ext") %>%
  fortify()
GSC <- subset(GB, NewSAMS == "GSC") %>%
  fortify()
NLS_SouthDeep <- subset(GB, NewSAMS == "NLS-South-Deep") %>%
  fortify()
NLS_West <- subset(GB, NewSAMS == "NLS-West") %>%
  fortify()
NLS_SouthShallow <- subset(GB, NewSAMS == "NLS-South-Shallow") %>%
  fortify()
CL2_AccessSouthwest <- subset(GB, NewSAMS == "CL2-Access-Southwest") %>%
  fortify()
SF_East <- subset(GB, NewSAMS == "SF-East") %>%
  fortify()

# combine polygons
GB_sf <- st_union(st_geometry(NLS_North), st_geometry(CL1_South)) %>%
  st_union(st_geometry(CL1_Sliver)) %>%
  st_union(st_geometry(CL2_AccessSoutheast)) %>%
  st_union(st_geometry(SF)) %>%
  st_union(st_geometry(CL2_North)) %>%
  st_union(st_geometry(CL1_Access)) %>%
  st_union(st_geometry(NF)) %>%
  st_union(st_geometry(CL2_Ext)) %>%
  st_union(st_geometry(GSC)) %>%
  st_union(st_geometry(NLS_SouthDeep)) %>%
  st_union(st_geometry(NLS_West)) %>%
  st_union(st_geometry(NLS_SouthShallow)) %>%
  st_union(st_geometry(CL2_AccessSouthwest)) %>%
  st_union(st_geometry(SF_East)) %>%
  st_remove_holes() # remove slivers between polygon borders
  
#summary(GB_sf)
```

## Create coastline polygon
```{r}
# turn off spherical geometry to avoid "duplicate vertex" errors
sf_use_s2(FALSE)

# get Massachusetts coastline
mass <- read_sf("/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library/gshhg-shp-2.3.7/GSHHS_shp/f/GSHHS_f_L1.shp") %>%
  st_make_valid() %>%
  st_crop(xmin = -71, xmax = -66, ymin = 40, ymax = 43)
```

## Import bathy data
```{r}
GB_bathy <- getNOAA.bathy(lon1 = -74, lon2 = -62, lat1 = 37, lat2 = 46, resolution = 1)

bathy_xyz <- as.xyz(GB_bathy)

# ggplot() +
#   geom_contour(data = bathy_xyz,
#                aes(x = V1, y = V2, z = V3),
#                binwidth = 100, alpha = 0.4) +
#   geom_contour(data = bathy_xyz,
#                aes(x = V1, y = V2, z = V3),
#                breaks = -50, alpha = 0.4, linetype = "dashed") +
#   geom_contour(data = bathy_xyz,
#                aes(x = V1, y = V2, z = V3),
#                breaks = -150, alpha = 0.4, linetype = "dashed") +
#   scale_y_continuous(breaks = c(40, 41, 42)) +
#   coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
#   theme_bw()
```

## Create simple features object of chem data
```{r}
# create geometry column in data frame from lat/long data
for(i in 1:nrow(oct)) {
  oct$geometry[i] <- st_point(x = c(oct$Long[i], oct$Lat[i])) %>%
    st_sfc(crs = 4326)
}

# create an sf object from data frame
station_sf <- st_sf(oct, crs = 4326)

bottom_sf <- station_sf %>%
  filter(Cast == "Bottom")

surface_sf <- station_sf %>%
  filter(Cast == "Surface")
```

## Begin interpolation round 1 (nearest-neighbor)
```{r}
bottom_sf_geom <- st_union(bottom_sf) %>%
  st_transform(crs = 26919)
bottom_sf_v <- st_voronoi(bottom_sf_geom)
bottom_sf_v <- st_sf(bottom_sf_v)

surface_sf_geom <- st_union(surface_sf) %>%
  st_transform(crs = 26919)
surface_sf_v <- st_voronoi(surface_sf_geom)
surface_sf_v <- st_sf(surface_sf_v)

# mask Voronoi with contour
bottom_sf_v <- st_intersection(st_cast(bottom_sf_v),
                               st_union(st_buffer(GB_sf, dist = 500)))
bottom_sf_v <- st_sf(bottom_sf_v)

#st_crs(bottom_sf_v)

bottom_sf2 <- bottom_sf %>%
  st_transform(crs = 26919)

surface_sf_v <- st_intersection(st_cast(surface_sf_v),
                                st_union(st_buffer(GB_sf, dist = 500)))
surface_sf_v <- st_sf(surface_sf_v)

#st_crs(surface_sf_v)

surface_sf2 <- surface_sf %>%
  st_transform(crs = 26919)

# complete spatial join
bottom_sf_v2 <- st_join(bottom_sf_v, bottom_sf2)
#glimpse(bottom_sf_v2)
surface_sf_v2 <- st_join(surface_sf_v, surface_sf2)
```

## Create simple features objects for 3 central points
```{r}
bottom_sf3 <- bottom_sf2 %>%
  filter(Station == "033" | Station == "034" | Station == "035")

surface_sf3 <- surface_sf2 %>%
  filter(Station == "033" | Station == "034" | Station == "035")
```

## Find property ranges
(move this once finalized)
```{r}
# Temp
min(bottom_sf2$Temp) # 8.317186
min(surface_sf2$Temp) # 14.26168
max(bottom_sf2$Temp) # 18.4182
max(surface_sf2$Temp) # 20.69855

# Sal
min(bottom_sf2$Salinity) # 32.4402
min(surface_sf2$Salinity) # 31.5991
max(bottom_sf2$Salinity) # 35.6009
max(surface_sf2$Salinity) # 34.0748

# DIC
min(bottom_sf2$DIC) # 1992.8
min(surface_sf2$DIC) # 1931.6
max(bottom_sf2$DIC) # 2154.9
max(surface_sf2$DIC) # 2035.2

# TA
min(bottom_sf2$TA) # 2181.2
min(surface_sf2$TA) # 2143.2
max(bottom_sf2$TA) # 2355
max(surface_sf2$TA) # 2281.1

# DO
min(bottom_sf2$DO) # 204.7499
min(surface_sf2$DO) # 246.2259
max(bottom_sf2$DO) # 274.0987
max(surface_sf2$DO) # 285.113

# pH
min(bottom_sf2$pH) # 7.855834
min(surface_sf2$pH) # 7.95683
max(bottom_sf2$pH) # 8.090394
max(surface_sf2$pH) # 8.099045

# pCO2
min(surface_sf2$pCO2) # 336.7068
max(surface_sf2$pCO2) # 491.8113

# OmegaAragonite
min(bottom_sf2$OmegaAragonite) # 1.300137
min(surface_sf2$OmegaAragonite) # 1.963683
max(bottom_sf2$OmegaAragonite) # 2.500784
max(surface_sf2$OmegaAragonite) # 3.101411

# AOU
min(bottom_sf2$AOU) # -36.19348
min(surface_sf2$AOU) # -46.67349
max(bottom_sf2$AOU) # 47.6479
max(surface_sf2$AOU) # -2.211892
```

## Interpolated surface plots
```{r}
ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = Temp), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = Temp), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  scale_fill_distiller(limits = c(6, 21), palette = "YlGnBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Surface Temperature [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank())

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = Salinity), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = Salinity), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(31, 36), palette = "OrRd",
                       direction = "horizontal",
                       aesthetics = c("fill", "colour"),
                       guide = guide_colorbar(reverse = TRUE)) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface Salinity [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DIC), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = DIC), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1930, 2155), option = "rocket",
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface DIC [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = TA), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = TA), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(2140, 2355), option = "mako", direction = -1,
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface Alkalinity [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = DO), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(200, 290), palette = "PuBuGn",
                       direction = "trans",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface DO [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = pH), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = pH), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(7.8, 8.25), option = "viridis",
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface pH [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = pCO2), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = pCO2), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(350, 550), option = "viridis",
                       aesthetics = c("fill", "colour"),
                       name = bquote(italic("p"~CO[2]))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface pCO2 [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = OmegaAragonite), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = OmegaAragonite), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1.3, 3.15), option = "mako",
                     aesthetics = c("fill", "colour"), name = "Ω Aragonite") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface Aragonite [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = AOU), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = AOU), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-55, 55), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface AOU [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = DO), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface DO [Oct]") +
  theme_bw()
```

## Interpolated bottom plots
```{r}
ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = Temp), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = Temp), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(6, 21), palette = "YlGnBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom Temperature [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = Salinity), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = Salinity), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(31, 36), palette = "OrRd",
                       direction = "horizontal",
                       aesthetics = c("fill", "colour"),
                       guide = guide_colorbar(reverse = TRUE)) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom Salinity [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DIC), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = DIC), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1930, 2155), option = "rocket",
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom DIC [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = TA), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = TA), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(2140, 2355), option = "mako", direction = -1,
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom Alkalinity [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DO), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = DO), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(200, 290), palette = "PuBuGn",
                       direction = "trans",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom DO [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = pH), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = pH), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(7.8, 8.25), option = "viridis",
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom pH [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = pCO2), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = pCO2), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(280, 560), palette = "RdBu",
                       aesthetics = c("fill", "colour"),
                       name = bquote(italic("p"~CO[2])),
                       breaks = c(300, 420, 540)) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom pCO2 [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = OmegaAragonite), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = OmegaAragonite), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1.3, 3.15), option = "mako",
                     aesthetics = c("fill", "colour"), name = "Ω Aragonite") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom Aragonite [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = AOU), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = AOU), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-55, 55), palette = "BrBG",
                       breaks = c(-50, -25, 0, 25, 50),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom AOU [Oct]") +
  theme_bw()
```

### DELTAs & SUBSEQUENT

## Bounds
```{r}
# dDIC
  #min(surface_sf2$dDIC, na.rm = TRUE) # -41.66683
sort(surface_sf2$dDIC)[2] # -24.51375
max(surface_sf2$dDIC, na.rm = TRUE) # 24.0487

  #min(bottom_sf2$dDIC, na.rm = TRUE) # -77.28295 - outlier
sort(bottom_sf2$dDIC)[2] # -41.48472
max(bottom_sf2$dDIC, na.rm = TRUE) # 61.10652

# dTA
min(surface_sf2$dTA, na.rm = TRUE) # -25.37055
max(surface_sf2$dTA, na.rm = TRUE) # 36.03762

min(bottom_sf2$dTA, na.rm = TRUE) # -31.77863
max(bottom_sf2$dTA, na.rm = TRUE) # 84.42403

# dDO
min(surface_sf2$dDO, na.rm = TRUE) # -14.7027
max(surface_sf2$dDO, na.rm = TRUE) # 14.18127

min(bottom_sf2$dDO, na.rm = TRUE) # -31.74614
max(bottom_sf2$dDO, na.rm = TRUE) # 9.814863

# flux
min(surface_sf2$flux, na.rm = TRUE) # -9450.262
max(surface_sf2$flux, na.rm = TRUE) # 7275.122

# DICf
min(surface_sf2$DICf, na.rm = TRUE) # -0.4051017
max(surface_sf2$DICf, na.rm = TRUE) # 0.9571934

min(bottom_sf2$DICf, na.rm = TRUE) # -0.2095367
max(bottom_sf2$DICf, na.rm = TRUE) # 0

# DICpr
min(surface_sf2$DICpr, na.rm = TRUE) # -25.8881
max(surface_sf2$DICpr, na.rm = TRUE) # 10.6237

min(bottom_sf2$DICpr, na.rm = TRUE) # -7.538953
max(bottom_sf2$DICpr, na.rm = TRUE) # 24.38472

# DIC.other
min(surface_sf2$DIC.other, na.rm = TRUE) # -33.9237
max(surface_sf2$DIC.other, na.rm = TRUE) # 37.92676

  #min(bottom_sf2$DIC.other, na.rm = TRUE) # -69.744 - outlier
sort(bottom_sf2$DIC.other)[2] # -42.61267
max(bottom_sf2$DIC.other, na.rm = TRUE) # 39.36212

# TApr
min(surface_sf2$TApr, na.rm = TRUE) # -1.7038
max(surface_sf2$TApr, na.rm = TRUE) # 4.151865

min(bottom_sf2$TApr, na.rm = TRUE) # -3.910756
max(bottom_sf2$TApr, na.rm = TRUE) # 1.209077

# TA.other
min(surface_sf2$TA.other, na.rm = TRUE) # -25.85842
max(surface_sf2$TA.other, na.rm = TRUE) # 33.90461

min(bottom_sf2$TA.other, na.rm = TRUE) # -30.8117
max(bottom_sf2$TA.other, na.rm = TRUE) # 87.72202
```

## More limits
```{r}
# CO2 eq days
min(abs(surface_sf2$d), na.rm = TRUE) # 6.146507
max(abs(surface_sf2$d), na.rm = TRUE) # 351.8752

# O2 eq days
min(abs(surface_sf2$d.O2), na.rm = TRUE) # 1.196218
max(abs(surface_sf2$d.O2), na.rm = TRUE) # 29.33125

# dDIC.ex
min(bottom_sf2$dDIC.ex, na.rm = TRUE) # 2.411912
max(bottom_sf2$dDIC.ex, na.rm = TRUE) # 39.12395

# dTA.ex
min(bottom_sf2$dTA.ex, na.rm = TRUE) # 14.62046
max(bottom_sf2$dTA.ex, na.rm = TRUE) # 87.4541

# ratio
min(bottom_sf2$ratio, na.rm = TRUE) # 1.017241
max(bottom_sf2$ratio, na.rm = TRUE) # 8.467042

# rel.DICn
min(bottom_sf2$rel.DICn, na.rm = TRUE) # 0.963789
min(surface_sf2$rel.DICn, na.rm = TRUE) # 0.9501362
max(bottom_sf2$rel.DICn, na.rm = TRUE) # 0.9987124
max(surface_sf2$rel.DICn, na.rm = TRUE) # 0.9990312

# rel.DICf
min(bottom_sf2$rel.DICf, na.rm = TRUE) # 0
min(surface_sf2$rel.DICf, na.rm = TRUE) # 0
max(bottom_sf2$rel.DICf, na.rm = TRUE) # 0.0003895451
max(surface_sf2$rel.DICf, na.rm = TRUE) # 0.001072598

# rel.DICpr
min(bottom_sf2$rel.DICpr, na.rm = TRUE) # 0
min(surface_sf2$rel.DICpr, na.rm = TRUE) # 0.00014422
max(bottom_sf2$rel.DICpr, na.rm = TRUE) # 0.0115217
max(surface_sf2$rel.DICpr, na.rm = TRUE) # 0.02573715

# rel.DICres
min(bottom_sf2$rel.DICres, na.rm = TRUE) # 0
min(surface_sf2$rel.DICres, na.rm = TRUE) # 0
max(bottom_sf2$rel.DICres, na.rm = TRUE) # 0.03334492
max(surface_sf2$rel.DICres, na.rm = TRUE) # 0.02372795
```

## Surface plots
```{r}
ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dDIC), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = dDIC), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-61, 61), palette = "RdBu",
                       #breaks = c(-70, 0, 70),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface delta DIC [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = flux / 10^3), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = flux / 10^3), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-12.5, 12.5), palette = "BrBG",
                       aesthetics = c("fill", "colour"),
                       name = "CO2 flux\n(mmol/m^2/d)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface CO2 flux [Oct]") +
  theme_bw() +
  theme(legend.title = element_text(face = "bold"))

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = abs(d)), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = abs(d)), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(63, 300), palette = "GnBu",
                       breaks = c(63, 100, 200, 300),
                       direction = "trans",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface CO2 eq time [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DICf), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = DICf), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gsea(limits = c(-2.5, 2.5), #palette = "RdBu",
                       #breaks = c(-40, -20, 0, 20, 40),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface DIC_flux [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dDO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = dDO), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-32, 32), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface delta DO [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = abs(d.O2)), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = abs(d.O2)), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(0, 30), palette = "GnBu",
                       direction = "trans",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface O2 eq time [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = flux.O2 / 10^3), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = flux.O2 / 10^3), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-120, 120), palette = "BrBG",
                       aesthetics = c("fill", "colour"),
                       name = "O2 flux\n(mmol/m^2/d)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface O2 flux [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DICpr), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = DICpr), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-500, 500), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface DIC_bio [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DIC.other), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = DIC.other), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-300, 300), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface DIC_residual [Oct]") +
  theme_bw()

mean(abs(oct$dDIC[which(!(oct$Cast=="Surface" & (oct$Station=="001" |
                                                      oct$Station=="002" |
                                                      oct$Station=="003" |
                                                      oct$Station=="004" |
                                                      oct$Station=="005")))]))
```

## Bottom plots
```{r}
ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dDIC), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dDIC), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-61, 61), palette = "RdBu",
                       #breaks = c(-70, 0, 70),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom delta DIC [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = flux / 10^3), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = flux / 10^3), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-12.5, 12.5), palette = "BrBG",
                       aesthetics = c("fill", "colour"),
                       name = "CO2 flux\n(mmol/m^2/d)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom CO2 flux [Oct]") +
  theme_bw() +
  theme(legend.title = element_text(face = "bold"))

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DICf), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = DICf), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-45, 45), palette = "RdBu",
                       breaks = c(-40, -20, 0, 20, 40),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom DIC_flux [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dDO), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dDO), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-32, 32), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom delta DO [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DICpr), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = DICpr), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-24, 24), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom DIC_bio [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DIC.other), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = DIC.other), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-57, 57), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom DIC_residual [Oct]") +
  theme_bw()
```

## Surface plots
```{r}
ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dTA), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = dTA), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-85, 85), palette = "RdBu",
                       breaks = c(-80, -40, 0, 40, 80),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface delta TA [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = TApr), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = TApr), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-4, 4), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface TA_bio [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = TA.other), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = TA.other), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-30, 30), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface TA_residual [Oct]") +
  theme_bw()
```

## Bottom plots
```{r}
ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dTA), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dTA), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-85, 85), palette = "RdBu",
                       breaks = c(-80, -40, 0, 40, 80),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom delta TA [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = TApr), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = TApr), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-4, 4), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom TA_bio [Oct]") +
  theme_bw()

ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = TA.other), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = TA.other), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(-30, 30), palette = "RdBu",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom TA_residual [Oct]") +
  theme_bw()
```

## Paper figures

### note to self that you should write export code to establish uniform size instead of winging it

### also, why are some of your legend titles bold but not all

# Temp vs Sal plots
```{r}
May.TvS <- ggplot() +
  geom_point(data = may[may$Cast == "Surface", ],
             aes(x = Salinity, y = Temp, shape = Cast), shape = 1, size = 1) +
  # EM1
  annotate("point", x = 33.02325, y = 7.220628, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 33.02325-0.04339896, xend = 33.02325+0.04339896, y = 7.220628, yend = 7.220628,
           col = "firebrick3") +
  annotate("segment", x = 33.02325, xend = 33.02325, y = 7.220628-0.069308, yend = 7.220628+0.069308,
           col = "firebrick3") +
  # EM2
  annotate("point", x = 32.30807, y = 8.128582, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.30807-0.01786962, xend = 32.30807+0.01786962, y = 8.128582, yend = 8.128582,
           col = "firebrick3") +
  annotate("segment", x = 32.30807, xend = 32.30807, y = 8.128582-0.05763103, yend = 8.128582+0.05763103,
           col = "firebrick3") +
  # EM3
  annotate("point", x = 32.8277, y = 8.868272, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.8277-0.05091169, xend = 32.8277+0.05091169, y = 8.868272, yend = 8.868272,
           col = "firebrick3") +
  annotate("segment", x = 32.8277, xend = 32.8277, y = 8.868272-0.008266555, yend = 8.868272+0.008266555,
           col = "firebrick3") +
  scale_x_continuous(limits = c(32.29, 34.43), breaks = c(33, 34)) +
  ylim(6.716, 10.164) +
  xlab("Salinity (PSU)") +
  ylab("Temperature (°C)") +
  labs(title = "May") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.title = element_text(face = "bold"),
        legend.position = "bottom")

Oct.TvS <- ggplot() +
  geom_point(data = oct[oct$Cast == "Surface", ],
             aes(x = Salinity, y = Temp, shape = Cast), shape = 1, size = 1) +
  # EM1
  annotate("point", x = 32.36303, y = 17.61663, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.36303-0.04299143, xend = 32.36303+0.04299143, y = 17.61663, yend = 17.61663,
           col = "firebrick3") +
  annotate("segment", x = 32.36303, xend = 32.36303, y = 17.61663-0.1872035, yend = 17.61663+0.1872035,
           col = "firebrick3") +
  # EM2
  annotate("point", x = 32.6138, y = 16.38836, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.6138-0.06364616, xend = 32.6138+0.06364616, y = 16.38836, yend = 16.38836,
           col = "firebrick3") +
  annotate("segment", x = 32.6138, xend = 32.6138, y = 16.38836-0.1211196, yend = 16.38836+0.1211196,
           col = "firebrick3") +
  # EM3
  annotate("point", x = 34.03515, y = 20.41137, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 34.03515-0.05607357, xend = 34.03515+0.05607357, y = 20.41137, yend = 20.41137,
           col = "firebrick3") +
  annotate("segment", x = 34.03515, xend = 34.03515, y = 20.41137-0.4061293, yend = 20.41137+0.4061293,
           col = "firebrick3") +
  # EM7
  annotate("point", x = 31.63787, y = 16.75489, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 31.63787-0.03885027, xend = 31.63787+0.03885027, y = 16.75489, yend = 16.75489,
           col = "firebrick3") +
  annotate("segment", x = 31.63787, xend = 31.63787, y = 16.75489-0.2673522, yend = 16.75489+0.2673522,
           col = "firebrick3") +
  xlim(31.59, 35.65) +
  ylim(8.22, 20.82) +
  xlab("Salinity (PSU)") +
  ylab("Temperature (°C)") +
  labs(title = "October") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.position = "none")

May.TvS.2 <- ggplot() +
  geom_point(data = may[may$Cast == "Bottom", ],
             aes(x = Salinity, y = Temp, shape = Cast), shape = 1, size = 1) +
  # EM4
  annotate("point", x = 32.60722, y = 6.913535, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.60722-0.02688573, xend = 32.60722+0.02688573, y = 6.913535, yend = 6.913535,
           col = "firebrick3") +
  annotate("segment", x = 32.60722, xend = 32.60722, y = 6.913535-0.06965717, yend = 6.913535+0.06965717,
           col = "firebrick3") +
  # EM5
  annotate("point", x = 32.92325, y = 8.043115, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.92325-0.01675843, xend = 32.92325+0.01675843, y = 8.043115, yend = 8.043115,
           col = "firebrick3") +
  annotate("segment", x = 32.92325, xend = 32.92325, y = 8.043115-0.1243565, yend = 8.043115+0.1243565,
           col = "firebrick3") +
  # EM6
  annotate("point", x = 32.9749, y = 6.843245, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.9749-0.02552783, xend = 32.9749+0.02552783, y = 6.843245, yend = 6.843245,
           col = "firebrick3") +
  annotate("segment", x = 32.9749, xend = 32.9749, y = 6.843245-0.04853802, yend = 6.843245+0.04853802,
           col = "firebrick3") +
  # EM7
  annotate("point", x = 34.3181, y = 9.877368, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 34.3181-0.1111572, xend = 34.3181+0.1111572, y = 9.877368, yend = 9.877368,
           col = "firebrick3") +
  annotate("segment", x = 34.3181, xend = 34.3181, y = 9.877368-0.2865716, yend = 9.877368+0.2865716,
           col = "firebrick3") +
  scale_x_continuous(limits = c(32.29, 34.43), breaks = c(33, 34)) +
  ylim(6.716, 10.164) +
  xlab("Salinity (PSU)") +
  ylab("Temperature (°C)") +
  theme_bw() +
  theme(legend.position = "none")

Oct.TvS.2 <- ggplot() +
  geom_point(data = oct[oct$Cast == "Bottom", ],
             aes(x = Salinity, y = Temp, shape = Cast), shape = 1, size = 1) +
  # EM4
  annotate("point", x = 32.5582, y = 18.31397, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.5582-0.01583919, xend = 32.5582+0.01583919, y = 18.31397, yend = 18.31397,
           col = "firebrick3") +
  annotate("segment", x = 32.5582, xend = 32.5582, y = 18.31397-0.1474015, yend = 18.31397+0.1474015,
           col = "firebrick3") +
  # EM5
  annotate("point", x = 32.98455, y = 8.538995, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.98455-0.02991062, xend = 32.98455+0.02991062, y = 8.538995, yend = 8.538995,
           col = "firebrick3") +
  annotate("segment", x = 32.98455, xend = 32.98455, y = 8.538995-0.3136846, yend = 8.538995+0.3136846,
           col = "firebrick3") +
  # EM6
  annotate("point", x = 35.49357, y = 15.75253, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 35.49357-0.1042053, xend = 35.49357+0.1042053, y = 15.75253, yend = 15.75253,
           col = "firebrick3") +
  annotate("segment", x = 35.49357, xend = 35.49357, y = 15.75253-0.3802984, yend = 15.75253+0.3802984,
           col = "firebrick3") +
  xlim(31.59, 35.65) +
  ylim(8.22, 20.82) +
  xlab("Salinity (PSU)") +
  ylab("Temperature (°C)") +
  theme_bw() +
  theme(legend.position = "none")

# legend.only <- ggplot() +
#   geom_point(data = oct, aes(x = Salinity, y = Temp, col = "Measured"), shape = 1) +
#   geom_point(data = may, aes(x = Salinity, y = Temp, col = "Endmember"), size = 2) +
#   scale_colour_manual(values = c("black", "firebrick3"),
#                       breaks = c("Measured", "Endmember"),
#                       name = "Value") +
#   scale_shape_manual(values = c(1, 16),
#                      guide = guide_legend(reverse = TRUE)) +
#   scale_size_manual(values = c(1.5, 3),
#                     name = "Value") +
#   guides(col = guide_legend(title.position = "top", override.aes = list(shape = c(1, 16), size = c(1.5, 3)))) +
#   theme_bw() +
#   theme(legend.title = element_text(face = "bold"),
#         legend.position = "left")

theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_title(May.TvS),
    get_title(Oct.TvS),
    ncol = 2, nrow = 1),
  plot_grid(
    May.TvS + theme(plot.title = element_blank(), legend.position = "none"),
    Oct.TvS + theme(plot.title = element_blank()),
    May.TvS.2,
    Oct.TvS.2,
    ncol = 2, nrow = 2,
    align = "hv"),
  nrow = 2,
  rel_heights = c(1, 18)
)

ggsave("Fig2.png", width = 6.5, height = 5.1, units = "in", dpi = 600, bg = "#ffffff")
```

# DIC/TA vs Sal plots
```{r}
May.DICvS <- ggplot() +
  geom_point(data = may,
             aes(x = Salinity, y = DIC, shape = Cast), size = 1) +
  scale_shape_manual(values = c(1, 16),
                     breaks = c("Surface", "Bottom"),
                     name = "Layer") +
  # EM1
  annotate("point", x = 33.02325, y = 2076.15, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 33.02325-0.04339896, xend = 33.02325+0.04339896, y = 2076.15, yend = 2076.15,
           col = "firebrick3") +
  annotate("segment", x = 33.02325, xend = 33.02325, y = 2076.15-6.64003, yend = 2076.15+6.64003,
           col = "firebrick3") +
  # EM2
  annotate("point", x = 32.30807, y = 2031.767, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.30807-0.01786962, xend = 32.30807+0.01786962, y = 2031.767, yend = 2031.767,
           col = "firebrick3") +
  annotate("segment", x = 32.30807, xend = 32.30807, y = 2031.767-2.814842, yend = 2031.767+2.814842,
           col = "firebrick3") +
  # EM3
  annotate("point", x = 32.8277, y = 2030.25, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.8277-0.05091169, xend = 32.8277+0.05091169, y = 2030.25, yend = 2030.25,
           col = "firebrick3") +
  annotate("segment", x = 32.8277, xend = 32.8277, y = 2030.25-1.626346, yend = 2030.25+1.626346,
           col = "firebrick3") +
  # EM4
  annotate("point", x = 32.60722, y = 2066.45, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.60722-0.02688573, xend = 32.60722+0.02688573, y = 2066.45, yend = 2066.45,
           col = "firebrick3") +
  annotate("segment", x = 32.60722, xend = 32.60722, y = 2066.45-8.914969, yend = 2066.45+8.914969,
           col = "firebrick3") +
  # EM5
  annotate("point", x = 32.92325, y = 2061.15, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.92325-0.01675843, xend = 32.92325+0.01675843, y = 2061.15, yend = 2061.15,
           col = "firebrick3") +
  annotate("segment", x = 32.92325, xend = 32.92325, y = 2061.15-5.586144, yend = 2061.15+5.586144,
           col = "firebrick3") +
  # EM6
  annotate("point", x = 32.9749, y = 2098.8, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.9749-0.02552783, xend = 32.9749+0.02552783, y = 2098.8, yend = 2098.8,
           col = "firebrick3") +
  annotate("segment", x = 32.9749, xend = 32.9749, y = 2098.8-4.521062, yend = 2098.8+4.521062,
           col = "firebrick3") +
  # EM7
  annotate("point", x = 34.3181, y = 2133.85, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 34.3181-0.1111572, xend = 34.3181+0.1111572, y = 2133.85, yend = 2133.85,
           col = "firebrick3") +
  annotate("segment", x = 34.3181, xend = 34.3181, y = 2133.85-5.020458, yend = 2133.85+5.020458,
           col = "firebrick3") +
  xlab("Salinity (PSU)") +
  scale_x_continuous(limits = c(32.29, 34.43), breaks = c(33, 34)) +
  ylab(expression("DIC (μmol kg"^-1*")")) +
  scale_y_continuous(breaks = c(2025, 2050, 2075, 2100, 2125)) +
  labs(title = "May") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.title = element_text(face = "bold"),
        legend.text = element_text(size = 10),
        legend.position = "left")

Oct.DICvS <- ggplot() +
  geom_point(data = oct,
             aes(x = Salinity, y = DIC, shape = Cast), size = 1) +
  scale_shape_manual(values = c(1, 16),
                     breaks = c("Surface", "Bottom"),
                     guide = guide_legend(reverse = TRUE)) +
  # EM1
  annotate("point", x = 32.36303, y = 1971.917, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.36303-0.04299143, xend = 32.36303+0.04299143, y = 1971.917, yend = 1971.917,
           col = "firebrick3") +
  annotate("segment", x = 32.36303, xend = 32.36303, y = 1971.917-12.34689, yend = 1971.917+12.34689,
           col = "firebrick3") +
  # EM2
  annotate("point", x = 32.6138, y = 2018.4, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.6138-0.06364616, xend = 32.6138+0.06364616, y = 2018.4, yend = 2018.4,
           col = "firebrick3") +
  annotate("segment", x = 32.6138, xend = 32.6138, y = 2018.4-3.668787, yend = 2018.4+3.668787,
           col = "firebrick3") +
  # EM3
  annotate("point", x = 34.03515, y = 2006.35, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 34.03515-0.05607357, xend = 34.03515+0.05607357, y = 2006.35, yend = 2006.35,
           col = "firebrick3") +
  annotate("segment", x = 34.03515, xend = 34.03515, y = 2006.35-9.828784, yend = 2006.35+9.828784,
           col = "firebrick3") +
  # EM7
  annotate("point", x = 31.63787, y = 1941.6, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 31.63787-0.03885027, xend = 31.63787+0.03885027, y = 1941.6, yend = 1941.6,
           col = "firebrick3") +
  annotate("segment", x = 31.63787, xend = 31.63787, y = 1941.6-8.669487, yend = 1941.6+8.669487,
           col = "firebrick3") +
  # EM4
  annotate("point", x = 32.5582, y = 1997.6, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.5582-0.01583919, xend = 32.5582+0.01583919, y = 1997.6, yend = 1997.6,
           col = "firebrick3") +
  annotate("segment", x = 32.5582, xend = 32.5582, y = 1997.6-6.788225, yend = 1997.6+6.788225,
           col = "firebrick3") +
  # EM5
  annotate("point", x = 32.98455, y = 2119.45, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.98455-0.02991062, xend = 32.98455+0.02991062, y = 2119.45, yend = 2119.45,
           col = "firebrick3") +
  annotate("segment", x = 32.98455, xend = 32.98455, y = 2119.45-0.6363961, yend = 2119.45+0.6363961,
           col = "firebrick3") +
  # EM6
  annotate("point", x = 35.49357, y = 2147.333, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 35.49357-0.1042053, xend = 35.49357+0.1042053, y = 2147.333, yend = 2147.333,
           col = "firebrick3") +
  annotate("segment", x = 35.49357, xend = 35.49357, y = 2147.333-8.093413, yend = 2147.333+8.093413,
           col = "firebrick3") +
  xlab("Salinity (PSU)") +
  ylab(expression("DIC (μmol kg"^-1*")")) +
  labs(title = "October") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.position = "none")

May.TAvS <- ggplot() +
  geom_point(data = may,
             aes(x = Salinity, y = TA, shape = Cast), size = 1) +
  scale_shape_manual(values = c(1, 16),
                     breaks = c("Surface", "Bottom"),
                     guide = guide_legend(reverse = TRUE)) +
  # EM1
  annotate("point", x = 33.02325, y = 2227.4, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 33.02325-0.04339896, xend = 33.02325+0.04339896, y = 2227.4, yend = 2227.4,
           col = "firebrick3") +
  annotate("segment", x = 33.02325, xend = 33.02325, y = 2227.4-2.255364, yend = 2227.4+2.255364,
           col = "firebrick3") +
  # EM2
  annotate("point", x = 32.30807, y = 2203.833, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.30807-0.01786962, xend = 32.30807+0.01786962, y = 2203.833, yend = 2203.833,
           col = "firebrick3") +
  annotate("segment", x = 32.30807, xend = 32.30807, y = 2203.833-2.411086, yend = 2203.833+2.411086,
           col = "firebrick3") +
  # EM3
  annotate("point", x = 32.8277, y = 2204.9, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.8277-0.05091169, xend = 32.8277+0.05091169, y = 2204.9, yend = 2204.9,
           col = "firebrick3") +
  annotate("segment", x = 32.8277, xend = 32.8277, y = 2204.9-9.616652, yend = 2204.9+9.616652,
           col = "firebrick3") +
  # EM4
  annotate("point", x = 32.60722, y = 2215.65, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.60722-0.02688573, xend = 32.60722+0.02688573, y = 2215.65, yend = 2215.65,
           col = "firebrick3") +
  annotate("segment", x = 32.60722, xend = 32.60722, y = 2215.65-3.51141, yend = 2215.65+3.51141,
           col = "firebrick3") +
  # EM5
  annotate("point", x = 32.92325, y = 2222.95, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.92325-0.01675843, xend = 32.92325+0.01675843, y = 2222.95, yend = 2222.95,
           col = "firebrick3") +
  annotate("segment", x = 32.92325, xend = 32.92325, y = 2222.95-10.67731, yend = 2222.95+10.67731,
           col = "firebrick3") +
  # EM6
  annotate("point", x = 32.9749, y = 2227.233, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.9749-0.02552783, xend = 32.9749+0.02552783, y = 2227.233, yend = 2227.233,
           col = "firebrick3") +
  annotate("segment", x = 32.9749, xend = 32.9749, y = 2227.233-1.625833, yend = 2227.233+1.625833,
           col = "firebrick3") +
  # EM7
  annotate("point", x = 34.3181, y = 2289.1, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 34.3181-0.1111572, xend = 34.3181+0.1111572, y = 2289.1, yend = 2289.1,
           col = "firebrick3") +
  annotate("segment", x = 34.3181, xend = 34.3181, y = 2289.1-3.818377, yend = 2289.1+3.818377,
           col = "firebrick3") +
  xlab("Salinity (PSU)") +
  scale_x_continuous(limits = c(32.29, 34.43), breaks = c(33, 34)) +
  ylab(expression("TA (μmol kg"^-1*")")) +
  theme_bw() +
  theme(legend.position = "none")

Oct.TAvS <- ggplot() +
  geom_point(data = oct,
             aes(x = Salinity, y = TA, shape = Cast), size = 1) +
  scale_shape_manual(values = c(1, 16),
                     breaks = c("Surface", "Bottom"),
                     guide = guide_legend(reverse = TRUE)) +
  # EM1
  annotate("point", x = 32.36303, y = 2185.983, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.36303-0.04299143, xend = 32.36303+0.04299143, y = 2185.983, yend = 2185.983,
           col = "firebrick3") +
  annotate("segment", x = 32.36303, xend = 32.36303, y = 2185.983-2.585666, yend = 2185.983+2.585666,
           col = "firebrick3") +
  # EM2
  annotate("point", x = 32.6138, y = 2199.65, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 32.6138-0.06364616, xend = 32.6138+0.06364616, y = 2199.65, yend = 2199.65,
           col = "firebrick3") +
  annotate("segment", x = 32.6138, xend = 32.6138, y = 2199.65-5.679495, yend = 2199.65+5.679495,
           col = "firebrick3") +
  # EM3
  annotate("point", x = 34.03515, y = 2279.6, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 34.03515-0.05607357, xend = 34.03515+0.05607357, y = 2279.6, yend = 2279.6,
           col = "firebrick3") +
  annotate("segment", x = 34.03515, xend = 34.03515, y = 2279.6-2.12132, yend = 2279.6+2.12132,
           col = "firebrick3") +
  # EM7
  annotate("point", x = 31.63787, y = 2162.1, size = 2, col = "firebrick3", shape = 1, stroke = 1.5) +
  annotate("segment", x = 31.63787-0.03885027, xend = 31.63787+0.03885027, y = 2162.1, yend = 2162.1,
           col = "firebrick3") +
  annotate("segment", x = 31.63787, xend = 31.63787, y = 2162.1-11.9662, yend = 2162.1+11.9662,
           col = "firebrick3") +
  # EM4
  annotate("point", x = 32.5582, y = 2181.3, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.5582-0.01583919, xend = 32.5582+0.01583919, y = 2181.3, yend = 2181.3,
           col = "firebrick3") +
  annotate("segment", x = 32.5582, xend = 32.5582, y = 2181.3-0.1414214, yend = 2181.3+0.1414214,
           col = "firebrick3") +
  # EM5
  annotate("point", x = 32.98455, y = 2227.9, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 32.98455-0.02991062, xend = 32.98455+0.02991062, y = 2227.9, yend = 2227.9,
           col = "firebrick3") +
  annotate("segment", x = 32.98455, xend = 32.98455, y = 2227.9-0.8485281, yend = 2227.9+0.8485281,
           col = "firebrick3") +
  # EM6
  annotate("point", x = 35.49357, y = 2349.533, size = 2.5, col = "firebrick3") +
  annotate("segment", x = 35.49357-0.1042053, xend = 35.49357+0.1042053, y = 2349.533, yend = 2349.533,
           col = "firebrick3") +
  annotate("segment", x = 35.49357, xend = 35.49357, y = 2349.533-4.966219, yend = 2349.533+4.966219,
           col = "firebrick3") +
  xlab("Salinity (PSU)") +
  ylab(expression("TA (μmol kg"^-1*")")) +
  theme_bw() +
  theme(legend.position = "none")

theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_title(May.DICvS),
    get_title(Oct.DICvS),
    ncol = 2, nrow = 1),
  plot_grid(
    May.DICvS + theme(plot.title = element_blank(), legend.position = "none"),
    Oct.DICvS + theme(plot.title = element_blank()),
    May.TAvS,
    Oct.TAvS,
    ncol = 2, nrow = 2,
    align = "hv"),
  nrow = 2,
  rel_heights = c(1, 18)
)

ggsave("Fig3.png", width = 6.5, height = 5.1, units = "in", dpi = 600, bg = "#ffffff")

plot_grid(
    get_legend(May.DICvS))

ggsave("Fig3_legend.png", width = 6.5, height = 5.1, units = "in", dpi = 600, bg = "#ffffff")
```

### 12-panel chem parameter maps
```{r}
# May
DIC <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = DIC), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = DIC), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1930, 2155),
                     option = "plasma",
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "DIC") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"),
        legend.text = element_text(angle = 45, vjust = 0.75, size = 7))

TA <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = TA), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = TA), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(2140, 2355),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("TA (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Total Alkalinity") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"),
        legend.text = element_text(angle = 45, vjust = 0.75, size = 7))

DO <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = DO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = DO), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(200, 330),
                       colours = carto_pal(7, "ag_GrnYl"),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DO (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Dissolved Oxygen") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"),
        legend.text = element_text(angle = 45, vjust = 0.75, size = 7))

DIC2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = DIC), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = DIC), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1930, 2155),
                     option = "plasma",
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

TA2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = TA), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = TA), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(2140, 2355),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("TA (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

DO2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = DO), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = DO), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(200, 330),
                       colours = carto_pal(7, "ag_GrnYl"),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DO (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom DO [May]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

# October
DICo <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DIC), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = DIC), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1930, 2155),
                     option = "plasma",
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "DIC") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

TAo <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = TA), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = TA), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(2140, 2355),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("TA (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Alkalinity") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

DOo <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = DO), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(200, 330),
                       colours = carto_pal(7, "ag_GrnYl"),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DO (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface DO [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

DIC2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DIC), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = DIC), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1930, 2155),
                     option = "plasma",
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

TA2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = TA), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = TA), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(2140, 2355),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("TA (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

DO2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DO), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = DO), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(200, 330),
                       colours = carto_pal(7, "ag_GrnYl"),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DO (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom DO [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

theme_set(theme_minimal())

plot_grid(
  #plot_grid(
  #  get_title(DIC),
  #  get_title(TA),
  #  get_title(DO),
  #  nrow = 1),
  plot_grid(
    get_legend(DIC),
    get_legend(TA),
    get_legend(DO),
    nrow = 1),
  plot_grid(
    DIC + theme(plot.title = element_blank(), legend.position = "none"),
    TA + theme(plot.title = element_blank(), legend.position = "none"),
    DO + theme(plot.title = element_blank(), legend.position = "none"),
    DIC2,
    TA2,
    DO2,
    DICo,
    TAo,
    DOo,
    DIC2o,
    TA2o,
    DO2o,
    ncol = 3, nrow = 4,
    align = "hv"),
    #labels = c("(A) May, surface", "", "", "(B) May, bottom", "", "", "(C) Oct, surface", "", "", "(D) Oct, bottom", "", "")),
  nrow = 2,
  #rel_heights = c(1, 48, 3)
  rel_heights = c(1.25, 12)
)

ggsave("Fig4.png", width = 6.5, height = 7.3, units = "in", dpi = 600, bg = "#ffffff")
```

### 12-panel derived parameter maps
```{r}
# May
pH <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = pH), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = pH), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(7.85, 8.17), option = "viridis",
                     aesthetics = c("fill", "colour"),
                     name = "pH (total scale)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "pH") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"))
 
omega <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = OmegaAragonite), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = OmegaAragonite), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1.3, 3.11), option = "inferno",
                       aesthetics = c("fill", "colour"),
                       name = "Ω Aragonite") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Ω Aragonite") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"))

AOU <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = AOU), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = AOU), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(-48, 48),
                       colours = rev(redmonder.pal(11, "dPBIRdGn")),
                       breaks = c(-40, -20, 0, 20, 40),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("AOU (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "AOU") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"))

pH2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = pH), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = pH), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(7.85, 8.17), option = "viridis",
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

omega2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = OmegaAragonite), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = OmegaAragonite), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1.3, 3.11), option = "inferno",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom Aragonite [May]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

AOU2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = AOU), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = AOU), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(-48, 48),
                       colours = rev(redmonder.pal(11, "dPBIRdGn")),
                       breaks = c(-40, -20, 0, 20, 40),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

# October
pHo <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = pH), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = pH), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(7.85, 8.17), option = "viridis",
                     aesthetics = c("fill", "colour"),
                     name = "pH                  ") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

omega.o <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = OmegaAragonite), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = OmegaAragonite), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1.3, 3.11), option = "inferno",
                       aesthetics = c("fill", "colour"),
                       name = "Omega\nAragonite        ") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface Aragonite [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

AOUo <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = AOU), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = AOU), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(-48, 48),
                       colours = rev(redmonder.pal(11, "dPBIRdGn")),
                       breaks = c(-40, -20, 0, 20, 40),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface AOU [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

pH2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = pH), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = pH), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(7.85, 8.17), option = "viridis",
                     aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

omega2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = OmegaAragonite), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = OmegaAragonite), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_viridis(limits = c(1.3, 3.11), option = "inferno",
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom Aragonite [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

AOU2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = AOU), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = AOU), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(-48, 48),
                       colours = rev(redmonder.pal(11, "dPBIRdGn")),
                       breaks = c(-40, -20, 0, 20, 40),
                       aesthetics = c("fill", "colour")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

theme_set(theme_minimal())

plot_grid(
  #plot_grid(
  #  get_title(pH),
  #  get_title(omega),
  #  get_title(AOU),
  #  nrow = 1),
  plot_grid(
    get_legend(pH),
    get_legend(omega),
    get_legend(AOU),
    nrow = 1),
  plot_grid(
    pH + theme(plot.title = element_blank(), legend.position = "none"),
    omega + theme(plot.title = element_blank(), legend.position = "none"),
    AOU + theme(plot.title = element_blank(), legend.position = "none"),
    pH2,
    omega2,
    AOU2,
    pHo,
    omega.o,
    AOUo,
    pH2o,
    omega2o,
    AOU2o,
    ncol = 3, nrow = 4,
    align = "hv"),
    #labels = c("(A) May, surface", "", "", "(B) May, bottom", "", "", "(C) Oct, surface", "", "", "(D) Oct, bottom", "", "")),
  nrow = 2,
  #rel_heights = c(1, 48, 3)
  rel_heights = c(1.2, 12)
)

ggsave("Fig5.png", width = 6.5, height = 7.3, units = "in", dpi = 600, bg = "#ffffff")
```

## 2-panel surface flux maps
```{r}
may_pCO2 <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = pCO2), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = pCO2), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(280, 492),
                       colours = ocean.haline(100),
                       aesthetics = c("fill", "colour"),
                       name = bquote(bold(pCO[2]*" (μatm)"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = bquote(bold(pCO[2]))) +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"))

may_flux <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = flux / 10^3), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = flux / 10^3), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  #scale_fill_gradientn(limits = c(-13, 13),
  scale_fill_gradientn(limits = c(-19, 19),
                       breaks = c(-18, -9, 0, 9, 18),
                       colours = rev(redmonder.pal(11, "dPBIPuGn")),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold(CO[2]*" air-sea flux (mmol m"^-2*" d"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = bquote(bold(CO[2]*" Flux"))) +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"))

oct_pCO2 <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = pCO2), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = pCO2), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(280, 492),
                       colours = ocean.haline(100),
                       aesthetics = c("fill", "colour"),
                       name = bquote(pCO[2]*" (μatm)")) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface pCO2 [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

oct_flux <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = flux / 10^3), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = flux / 10^3), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  #scale_fill_gradientn(limits = c(-13, 13),
  scale_fill_gradientn(limits = c(-19, 19),
                       breaks = c(-18, -9, 0, 9, 18),
                       colours = rev(redmonder.pal(11, "dPBIPuGn")),
                       aesthetics = c("fill", "colour"),
                       name = "CO2 flux\n(mmol m^-2 d^-1)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface CO2 flux [Oct]") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

theme_set(theme_minimal())

plot_grid(
  #plot_grid(
  #  get_title(may_pCO2),
  #  get_title(may_flux),
  #  nrow = 1),
  plot_grid(
    get_legend(may_pCO2),
    get_legend(may_flux),
    nrow = 1),
  plot_grid(
    may_pCO2 + theme(plot.title = element_blank(), legend.position = "none"),
    may_flux + theme(plot.title = element_blank(), legend.position = "none"),
    oct_pCO2,
    oct_flux,
    ncol = 2, nrow = 2,
    align = "hv"),
    #labels = c("(A) May, surface", "", "(B) Oct, surface", "")),
  nrow = 2,
  #rel_heights = c(1, 3, 24)
  rel_heights = c(1, 6)
)

ggsave("Fig6.png", width = 4.425, height = 4.1, units = "in", dpi = 600, bg = "#ffffff")
```

## 6-panel delta plots
```{r}
deltaTA.DIC <- ggplot() +
  geom_point(data = may, aes(x = dDIC, y = dTA, col = Cast), shape = 1, size = 1) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -median(may$sdDICn, na.rm = TRUE),
           xmax = median(may$sdDICn, na.rm = TRUE),
           ymin = -Inf,
           ymax = Inf) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -Inf,
           xmax = -median(may$sdDICn, na.rm = TRUE),
           ymin = -median(may$sdTAn, na.rm = TRUE),
           ymax = median(may$sdTAn, na.rm = TRUE)) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = median(may$sdDICn, na.rm = TRUE),
           xmax = Inf,
           ymin = -median(may$sdTAn, na.rm = TRUE),
           ymax = median(may$sdTAn, na.rm = TRUE)) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_abline(slope = 2) +
  geom_abline(slope = -17/106) +
  scale_colour_manual(values = c("royalblue", "coral"),
                     guide = guide_legend(reverse = TRUE),
                     name = "Layer") +
  #guides(col = guide_legend(title.position = "top", title.hjust = 0.5)) +
  labs(title = "       May", x = expression("ΔDIC (μmol kg"^-1*")"), y = expression("ΔTA (μmol kg"^-1*")")) +
  scale_y_continuous(breaks = c(-30, -20, -10, 0, 10, 20, 30)) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.title = element_text(face = "bold"),
        legend.text = element_text(size = 10))

deltaDO.DIC <- ggplot() +
  geom_point(data = may, aes(x = dDIC, y = dDO, col = Cast), shape = 1, size = 1) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -median(may$sdDICn, na.rm = TRUE),
           xmax = median(may$sdDICn, na.rm = TRUE),
           ymin = -Inf,
           ymax = Inf) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -Inf,
           xmax = -median(may$sdDICn, na.rm = TRUE),
           ymin = -median(may$sdDOn, na.rm = TRUE),
           ymax = median(may$sdDOn, na.rm = TRUE)) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = median(may$sdDICn, na.rm = TRUE),
           xmax = Inf,
           ymin = -median(may$sdDOn, na.rm = TRUE),
           ymax = median(may$sdDOn, na.rm = TRUE)) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_abline(slope = -138/106) +
  scale_colour_manual(values = c("royalblue", "coral"),
                     guide = guide_legend(reverse = TRUE)) +
  labs(x = expression("ΔDIC (μmol kg"^-1*")"), y = expression("ΔDO (μmol kg"^-1*")")) +
  theme_bw() +
  theme(legend.position = "none",
        axis.text = element_text(size = 9))

deltaDO.TA <- ggplot() +
  geom_point(data = may, aes(x = dTA, y = dDO, col = Cast), shape = 1, size = 1) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -median(may$sdTAn, na.rm = TRUE),
           xmax = median(may$sdTAn, na.rm = TRUE),
           ymin = -Inf,
           ymax = Inf) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -Inf,
           xmax = -median(may$sdTAn, na.rm = TRUE),
           ymin = -median(may$sdDOn, na.rm = TRUE),
           ymax = median(may$sdDOn, na.rm = TRUE)) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = median(may$sdTAn, na.rm = TRUE),
           xmax = Inf,
           ymin = -median(may$sdDOn, na.rm = TRUE),
           ymax = median(may$sdDOn, na.rm = TRUE)) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_abline(slope = -138/-17) +
  scale_colour_manual(values = c("royalblue", "coral"),
                     guide = guide_legend(reverse = TRUE)) +
  labs(x = expression("ΔTA (μmol kg"^-1*")"), y = expression("ΔDO (μmol kg"^-1*")")) +
  theme_bw() +
  theme(legend.position = "none",
        axis.text = element_text(size = 9))

deltaTA.DICo <- ggplot() +
  geom_point(data = oct, aes(x = dDIC, y = dTA, col = Cast), shape = 1, size = 1) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -median(oct$sdDICn, na.rm = TRUE),
           xmax = median(oct$sdDICn, na.rm = TRUE),
           ymin = -Inf,
           ymax = Inf) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -Inf,
           xmax = -median(oct$sdDICn, na.rm = TRUE),
           ymin = -median(oct$sdTAn, na.rm = TRUE),
           ymax = median(oct$sdTAn, na.rm = TRUE)) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = median(oct$sdDICn, na.rm = TRUE),
           xmax = Inf,
           ymin = -median(oct$sdTAn, na.rm = TRUE),
           ymax = median(oct$sdTAn, na.rm = TRUE)) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_abline(slope = 2) +
  geom_abline(slope = -17/106) +
  scale_colour_manual(values = c("royalblue", "coral"),
                     guide = guide_legend(reverse = TRUE)) +
  labs(title = "     October", x = expression("ΔDIC (μmol kg"^-1*")"), y = expression("ΔTA (μmol kg"^-1*")")) +
  theme_bw() +
  theme(plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.position = "none",
        axis.text = element_text(size = 9))

deltaDO.DICo <- ggplot() +
  geom_point(data = oct, aes(x = dDIC, y = dDO, col = Cast), shape = 1, size = 1) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -median(oct$sdDICn, na.rm = TRUE),
           xmax = median(oct$sdDICn, na.rm = TRUE),
           ymin = -Inf,
           ymax = Inf) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -Inf,
           xmax = -median(oct$sdDICn, na.rm = TRUE),
           ymin = -median(oct$sdDOn, na.rm = TRUE),
           ymax = median(oct$sdDOn, na.rm = TRUE)) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = median(oct$sdDICn, na.rm = TRUE),
           xmax = Inf,
           ymin = -median(oct$sdDOn, na.rm = TRUE),
           ymax = median(oct$sdDOn, na.rm = TRUE)) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_abline(slope = -138/106) +
  scale_colour_manual(values = c("royalblue", "coral"),
                     guide = guide_legend(reverse = TRUE)) +
  labs(x = expression("ΔDIC (μmol kg"^-1*")"), y = expression("ΔDO (μmol kg"^-1*")")) +
  theme_bw() +
  theme(legend.position = "none",
        axis.text = element_text(size = 9))

deltaDO.TAo <- ggplot() +
  geom_point(data = oct, aes(x = dTA, y = dDO, col = Cast), shape = 1, size = 1) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -median(oct$sdTAn, na.rm = TRUE),
           xmax = median(oct$sdTAn, na.rm = TRUE),
           ymin = -Inf,
           ymax = Inf) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = -Inf,
           xmax = -median(oct$sdTAn, na.rm = TRUE),
           ymin = -median(oct$sdDOn, na.rm = TRUE),
           ymax = median(oct$sdDOn, na.rm = TRUE)) +
  annotate("rect", alpha = 0.2, fill = "grey50",
           xmin = median(oct$sdTAn, na.rm = TRUE),
           xmax = Inf,
           ymin = -median(oct$sdDOn, na.rm = TRUE),
           ymax = median(oct$sdDOn, na.rm = TRUE)) +
  geom_vline(xintercept = 0, linetype = 2) +
  geom_hline(yintercept = 0, linetype = 2) +
  geom_abline(slope = -138/-17) +
  scale_colour_manual(values = c("royalblue", "coral"),
                     guide = guide_legend(reverse = TRUE)) +
  labs(x = expression("ΔTA (μmol kg"^-1*")"), y = expression("ΔDO (μmol kg"^-1*")")) +
  theme_bw() +
  theme(legend.position = "none",
        axis.text = element_text(size = 9))

plot_grid(
  plot_grid(
    get_title(deltaTA.DIC),
    get_title(deltaTA.DICo),
    nrow = 1),
  plot_grid(
    deltaTA.DIC + theme(plot.title = element_blank(), legend.position = "none"),
    deltaTA.DICo + theme(plot.title = element_blank()),
    deltaDO.DIC,
    deltaDO.DICo,
    deltaDO.TA,
    deltaDO.TAo,
    ncol = 2, nrow = 3,
    align = "hv"),
    #labels = c("A", "B", "C", "D", "E", "F")),
  #plot_grid(
  #  get_legend(deltaTA.DIC)),
  nrow = 2,
  rel_heights = c(1, 30)
)

ggsave("Fig7.png", width = 6.5, height = 7.4, units = "in", dpi = 600, bg = "#ffffff")

plot_grid(get_legend(deltaTA.DIC))

ggsave("Fig7_legend.png", width = 6.5, height = 7.4, units = "in", dpi = 600, bg = "#ffffff")
```

## 8-panel relative contribution maps (Oct)
```{r}
dDIC <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dDIC), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_v2[surface_sf_v2$Station == "009", ],
          fill = "grey8",
          size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = dDIC), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-24.05, 24.05),
                       breaks = c(-24, -12, 0, 12, 24),
                       aesthetics = c("fill", "colour"),
                       name = "ΔDIC") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Surface") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.28, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

oDICpr <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DICpr), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = DICpr), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-24.39, 24.39),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC"["bio"]))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface DIC_bio [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

oDICf <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DICf), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_v2[surface_sf_v2$Station == "009", ],
          fill = "grey8",
          size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = DICf), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-0.88, 0.88),
                       breaks = c(-0.8, -0.4, 0, 0.4, 0.8),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC"["air-sea"]))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface DIC_flux [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

oDICo <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = DIC.other), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = DIC.other), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-42.62, 42.62),
                       aesthetics = c("fill", "colour"),
                       name = "ε") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface DIC_residual [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 11),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

dDIC2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dDIC), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_v2[bottom_sf_v2$Station == "009", ],
          fill = "grey8",
          size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = dDIC), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-61.11, 61.11),
                       breaks = c(-60, -30, 0, 30, 60),
                       aesthetics = c("fill", "colour"),
                       name = "ΔDIC") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Bottom") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.28, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

oDICpr2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DICpr), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = DICpr), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-24.39, 24.39),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC"["bio"]))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom DIC_bio [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

oDICf2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DICf), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = DICf), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-0.88, 0.88),
                       breaks = c(-0.8, -0.4, 0, 0.4, 0.8),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("DIC"["air-sea"]))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom DIC_flux [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

oDICo2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = DIC.other), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_v2[bottom_sf_v2$Station == "009", ],
          fill = "grey8",
          size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = DIC.other), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-42.62, 42.62),
                       aesthetics = c("fill", "colour"),
                       name = "ε") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom DIC_residual [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 11),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))
```

## Same for TA
```{r}
dTA <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dTA), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = dTA), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-36.07, 36.07),
                       breaks = c(-30, -15, 0, 15, 30),
                       aesthetics = c("fill", "colour"),
                       name = "ΔTA") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Surface") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.28, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

TApr <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = TApr), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = TApr), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-4.05, 4.05),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("TA"["bio"]))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface TA_bio [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

TAo <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = TA.other), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = TA.other), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-34.02, 34.02),
                       breaks = c(-30, -15, 0, 15, 30),
                       aesthetics = c("fill", "colour"),
                       name = "ε") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface TA_residual [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 11),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.28, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

dTA2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dTA), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = dTA), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-84.43, 84.43),
                       breaks = c(-80, -40, 0, 40, 80),
                       aesthetics = c("fill", "colour"),
                       name = "ΔTA") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Bottom") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.28, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

TApr2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = TApr), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = TApr), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-4.05, 4.05),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("TA"["bio"]))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom TA_bio [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

TAo2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = TA.other), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = TA.other), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-87.73, 87.73), #palette = "RdBu",
                       breaks = c(-84, -42, 0, 42, 84),
                       aesthetics = c("fill", "colour"),
                       name = "ε") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom TA_residual [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 11),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.28, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))
```

## Build massive combo plot
```{r}
theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_title(dDIC),
    get_title(dDIC2),
    get_title(dDIC),
    get_title(dDIC2),
    ncol = 4
    ),
  plot_grid(
    plot_grid(
      plot_grid(
        get_legend(dDIC),
        get_legend(dDIC2)
      ),
      plot_grid(
        dDIC + theme(plot.title = element_blank(), legend.position = "none"),
        dDIC2 + theme(plot.title = element_blank(), legend.position = "none"),
        nrow = 1,
        align = "hv"
      ),
      plot_grid(
        get_legend(oDICpr)
      ),
      plot_grid(
        oDICpr + theme(legend.position = "none"),
        oDICpr2 + theme(legend.position = "none"),
        ncol = 2
      ),
      plot_grid(
        get_legend(oDICf)
      ),
      plot_grid(
        oDICf + theme(legend.position = "none"),
        oDICf2 + theme(legend.position = "none"),
        ncol = 2,
        align = "hv"
      ),
      plot_grid(
        get_legend(oDICo)
      ),
      plot_grid(
        oDICo + theme(legend.position = "none"),
        oDICo2 + theme(legend.position = "none"),
        ncol = 2,
        align = "hv"
      ),
      nrow = 8,
      rel_heights = c(1, 6, 1, 6, 1, 6, 1, 6)
    ),
    plot_grid(
      plot_grid(
        get_legend(dTA),
        get_legend(dTA2)
      ),
      plot_grid(
        dTA + theme(plot.title = element_blank(), legend.position = "none"),
        dTA2 + theme(plot.title = element_blank(), legend.position = "none"),
        nrow = 1),
      plot_grid(
        get_legend(TApr)
      ),
      plot_grid(
        TApr + theme(legend.position = "none"),
        TApr2 + theme(legend.position = "none"),
        ncol = 2
      ),
      plot_grid(
        get_legend(TApr + theme(legend.position = "none"))
      ),
      plot_grid(
        ggplot(),
        ggplot(),
        ncol = 2,
        align = "hv"),
      plot_grid(
        get_legend(TAo),
        get_legend(TAo2)
      ),
      plot_grid(
        TAo + theme(legend.position = "none"),
        TAo2 + theme(legend.position = "none"),
        ncol = 2,
        align = "hv"),
      nrow = 8,
      rel_heights = c(1, 6, 1, 6, 1, 6, 1, 6)
    ),
    ncol = 2
  ),
  nrow = 2,
  rel_heights = c(1, 24)
)

ggsave("Fig9.png", width = 6.5, height = 6.8, units = "in", dpi = 600, bg = "#ffffff")
```

## Supplement
```{r}
# May
T <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = Temp), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = Temp), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(6.7, 20.7), palette = "YlGnBu",
                       breaks = c(8, 12, 16, 20),
                       aesthetics = c("fill", "colour"),
                       name = "Temp (°C)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Temperature") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"))

S <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = Salinity), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = Salinity), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(31.5, 35.7),
                       colours = parula(100),
                       breaks = c(32, 33, 34, 35),
                       aesthetics = c("fill", "colour"),
                       name = "Salinity (PSU)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "Salinity") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold", size = 10),
        legend.position = "bottom",
        legend.key.width = unit(0.39, "in"),
        legend.key.height = unit(0.15, "in"))

T2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = Temp), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = Temp), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(6.7, 20.7), palette = "YlGnBu",
                       aesthetics = c("fill", "colour"),
                       name = "Temp (°C)      ") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Temperature") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

S2 <- ggplot() +
  geom_sf(data = bottom_sf_m_v2, aes(fill = Salinity), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_m3, aes(fill = Salinity), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(31.5, 35.7),
                       colours = parula(100),
                       breaks = c(32, 33, 34, 35),
                       aesthetics = c("fill", "colour"),
                       name = "Salinity (PSU)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

# October
To <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = Temp), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = Temp), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(6.7, 20.7), palette = "YlGnBu",
                       aesthetics = c("fill", "colour"),
                       name = "Temp (°C)      ") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

So <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = Salinity), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = Salinity), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(31.5, 35.7),
                       colours = parula(100),
                       breaks = c(32, 33, 34, 35),
                       aesthetics = c("fill", "colour"),
                       name = "Salinity (PSU)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Salinity") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

T2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = Temp), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = Temp), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(6.7, 20.7), palette = "YlGnBu",
                       aesthetics = c("fill", "colour"),
                       name = "Temp (°C)      ") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Bottom") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

S2o <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = Salinity), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(fill = Salinity), size = 2.25, shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(31.5, 35.7),
                       colours = parula(100),
                       breaks = c(32, 33, 34, 35),
                       aesthetics = c("fill", "colour"),
                       name = "Salinity (PSU)") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "") +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "none")

theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_legend(T),
    get_legend(S),
    nrow = 1),
  plot_grid(
    T + theme(plot.title = element_blank(), legend.position = "none"),
    S + theme(plot.title = element_blank(), legend.position = "none"),
    T2,
    S2,
    To,
    So,
    T2o,
    S2o,
    ncol = 2, nrow = 4,
    align = "hv"),
    #labels = c("A", "", "B", "", "C", "", "D", "")),
  nrow = 2,
  rel_heights = c(1, 12)
)

ggsave("SuppFig4.png", width = 4.425, height = 7.3, units = "in", dpi = 600, bg = "#ffffff")
```

## excess TA-DIC dissolution
```{r}
lm(oct$dTA.ex ~ oct$dDIC.ex)

oct %>%
  filter(Cast == "Bottom") %>%
ggplot() +
  geom_point(aes(x = dDIC.ex, y = dTA.ex, shape = Cast, col = "Oct"), shape = 1, size = 2) +
  geom_smooth(aes(x = dDIC.ex, y = dTA.ex), method = "lm", col = "royalblue", fill = "royalblue", alpha = 0.25) +
  geom_abline(slope = 2, linetype = 2) +
  annotate("text", x = 32, y = 92, label = "y = 2.042x + 2.63", fontface = 4, col = "royalblue", size = 4) +
  scale_shape_manual(values = c(16, 1),
                     guide = guide_legend(reverse = TRUE)) +
  scale_colour_manual(values = "royalblue",
                      name = "Month") +
  labs(x = expression("Residual DIC (μmol kg"^-1*")"), y = expression("Residual TA (μmol kg"^-1*")")) +
  theme_bw() +
  theme(legend.position = "none")

ggsave("SuppFig5.png", width = 6.5, height = 4.6, units = "in", dpi = 600, bg = "#ffffff")

oct %>%
  filter(Cast == "Bottom") %>%
ggplot() +
  geom_point(aes(x = OmegaAragonite, y = dTA.ex/dDIC.ex, shape = Cast, col = "Oct"), shape = 1, size = 2) +
  scale_shape_manual(values = c(16, 1),
                     guide = guide_legend(reverse = TRUE)) +
  scale_colour_manual(values = "royalblue",
                      name = "Month") +
  labs(x = expression("Omega Aragonite"), y = expression("Residual TA / Residual DIC")) +
  theme_bw() +
  theme(legend.position = "none")
```

## dO2 & O2 flux
```{r}
dDO <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = dDO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = dDO), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-31.75, 31.75),
                       breaks = c(-30, -15, 0, 15, 30),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("ΔDO (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "May") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

O2.flux <- ggplot() +
  geom_sf(data = surface_sf_m_v2, aes(fill = flux.O2/10^3), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_m3, aes(fill = flux.O2/10^3), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-151, 151),
                       breaks = c(-150, -75, 0, 75, 150),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold(O[2]*" air-sea flux (mmol m"^-2*" d"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface TA_bio [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

dDO2 <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dDO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = dDO), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-31.75, 31.75),
                       breaks = c(-30, -15, 0, 15, 30),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold("ΔDO (μmol kg"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  labs(title = "October") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold.italic", hjust = 0.5, size = 12),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

O2.flux2 <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = flux.O2/10^3), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(fill = flux.O2/10^3), shape = 23, linetype = "dashed") +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -50, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -100, alpha = 0.3, colour = "grey50") +
  geom_contour(data = bathy_xyz,
               aes(x = V1, y = V2, z = V3),
               breaks = -500, alpha = 0.3, colour = "grey50") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(colours = diverging_hcl(100, "Blue-Red 3"),
                       limits = c(-151, 151),
                       breaks = c(-150, -75, 0, 75, 150),
                       aesthetics = c("fill", "colour"),
                       name = expression(bold(O[2]*" air-sea flux (mmol m"^-2*" d"^-1*")"))) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  #labs(title = "Surface TA_bio [Oct]") +
  guides(fill = guide_colourbar(title.position = "top", title.hjust = 0.5),
         col = guide_colourbar(title.position = "top", title.hjust = 0.5)) +
  theme_bw() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold", size = 9),
        legend.text = element_text(size = 7),
        legend.position = "top",
        legend.key.height = unit(0.09, "in"),
        legend.key.width = unit(0.60, "in"),
        legend.spacing.y = unit(0.03, "in"),
        legend.margin = margin(0, 0, 0, 0))

plot_grid(
  plot_grid(
    get_title(dDO),
    get_title(dDO2)
  ),
  plot_grid(
    plot_grid(
      get_legend(dDO)
    ),
    plot_grid(
      dDO + theme(plot.title = element_blank(), legend.position = "none"),
      dDO2 + theme(plot.title = element_blank(), legend.position = "none"),
      nrow = 1,
      align = "hv"
    ),
    plot_grid(
      get_legend(O2.flux)
    ),
    plot_grid(
      O2.flux + theme(legend.position = "none"),
      O2.flux2 + theme(legend.position = "none"),
      ncol = 2,
      align = "hv"
    ),
    nrow = 4,
    rel_heights = c(1, 6, 1, 6)
  ),
  nrow = 2,
  rel_heights = c(1, 12)
)

ggsave("SuppFig6.png", width = 3.25, height = 3.54, units = "in", dpi = 600, bg = "#ffffff")
```










## DIC & TA solo plots
```{r}
theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_title(dDIC)),
  plot_grid(
    get_title(dDIC2)),
  plot_grid(
    dDIC + theme(plot.title = element_blank()),
    oDICf,
    oDICpr,
    oDICo,
    nrow = 4,
    align = "hv",
    labels = c("A", "B", "C", "D")),
  plot_grid(
    dDIC2 + theme(plot.title = element_blank()),
    oDICf2,
    oDICpr2,
    oDICo2,
    nrow = 4,
    align = "hv"),
  ncol = 2, nrow = 2,
  rel_heights = c(1, 32)
)

plot_grid(
  plot_grid(
    get_title(dTA)),
  plot_grid(
    get_title(dTA2)),
  plot_grid(
    dTA + theme(plot.title = element_blank()),
    TApr,
    TAo,
    ncol = 1,
    align = "hv",
    labels = c("A", "B", "C", "D")),
  plot_grid(
    dTA2 + theme(plot.title = element_blank()),
    TApr2,
    TAo2,
    ncol = 1,
    align = "hv"),
  ncol = 2, nrow = 2,
  rel_heights = c(1, 32)
)
```














## 6-panel delta maps (Oct)
```{r}
# dDIC: 28/61, dTA: 37/85, dDO: 15/32

dDIC <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dDIC), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_v2[surface_sf_v2$Station == "009", ],
          fill = "midnightblue",
          size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = dDIC), size = 6, shape = 18) +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gsea(limits = c(-28, 28),
                       breaks = c(-25, 0, 25),
                       aesthetics = c("fill", "colour"),
                       name = "ΔDIC") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold.italic", hjust = 0.5),
        legend.title = element_text(face = "bold"))

dTA <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dTA), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = dTA), size = 6, shape = 18) +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gsea(limits = c(-37, 37),
                       breaks = c(-30, -15, 0, 15, 30),
                       aesthetics = c("fill", "colour"),
                       name = "ΔTA") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Surface delta TA [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

dDO <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = dDO), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = dDO), size = 6, shape = 18) +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gsea(limits = c(-15, 15),
                       breaks = c(-12, -6, 0, 6, 12),
                       aesthetics = c("fill", "colour"),
                       name = "ΔDO") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Surface delta DO [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

dDIC2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dDIC), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf_v2[bottom_sf_v2$Station == "009", ],
          fill = "midnightblue",
          size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dDIC), size = 6, shape = 18) +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gsea(limits = c(-61, 61),
                       breaks = c(-60, -30, 0, 30, 60),
                       aesthetics = c("fill", "colour"),
                       name = "ΔDIC") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold.italic", hjust = 0.5),
        legend.title = element_text(face = "bold"))

dTA2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dTA), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dTA), size = 6, shape = 18) +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gsea(limits = c(-85, 85),
                       breaks = c(-80, -40, 0, 40, 80),
                       aesthetics = c("fill", "colour"),
                       name = "ΔTA") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Bottom delta TA [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

dDO2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dDO), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dDO), size = 6, shape = 18) +
  geom_sf(data = GB_sf, fill = NA, linewidth = 0.4, linetype = "dashed") +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gsea(limits = c(-32, 32),
                       breaks = c(-30, -15, 0, 15, 30),
                       aesthetics = c("fill", "colour"),
                       name = "ΔDO") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Bottom delta DO [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_title(dDIC)),
  plot_grid(
    ggplot()),
  plot_grid(
    get_title(dDIC2)),
  plot_grid(
    ggplot()),
  plot_grid(
    dDIC + theme(plot.title = element_blank(), legend.position = "none"),
    dTA + theme(legend.position = "none"),
    dDO + theme(legend.position = "none"),
    nrow = 3,
    align = "hv",
    labels = c("A", "B", "C")),
  plot_grid(
    get_legend(dDIC),
    ggplot(),
    get_legend(dTA),
    ggplot(),
    get_legend(dDO),
    ggplot(),
    nrow = 3),
  plot_grid(
    dDIC2 + theme(plot.title = element_blank(), legend.position = "none"),
    dTA2 + theme(legend.position = "none"),
    dDO2 + theme(legend.position = "none"),
    nrow = 3,
    align = "hv"),
  plot_grid(
    get_legend(dDIC2),
    ggplot(),
    get_legend(dTA2),
    ggplot(),
    get_legend(dDO2),
    ggplot(),
    nrow = 3),
  ncol = 4, nrow = 2,
  rel_heights = c(1, 32),
  rel_widths = c(12, 1, 12, 1)
)
```

## 8-panel percent contribution maps (Oct)
```{r}
rel.DICf <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = rel.DICf), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = rel.DICf), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔDIC.flux") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold"))

rel.DICpr <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = rel.DICpr), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = rel.DICpr), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔDIC.bio") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Surface DIC_bio [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

rel.DICres <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = rel.DICres), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = rel.DICres), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔDIC.res") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Surface DIC_residual [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

rel.DICf2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = rel.DICf), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = rel.DICf), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔDIC.flux") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold"))

rel.DICpr2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = rel.DICpr), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = rel.DICpr), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔDIC.bio") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Bottom DIC_bio [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

rel.DICres2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = rel.DICres), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = rel.DICres), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔDIC.res") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Bottom DIC_residual [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_title(rel.DICf)),
  plot_grid(
    get_title(rel.DICf2)),
  plot_grid(
    ggplot()),
  plot_grid(
    rel.DICf + theme(plot.title = element_blank(), legend.position = "none"),
    rel.DICpr + theme(legend.position = "none"),
    rel.DICres + theme(legend.position = "none"),
    ncol = 1,
    align = "hv",
    labels = c("A", "B", "C", "D")),
  plot_grid(
    rel.DICf2 + theme(plot.title = element_blank(), legend.position = "none"),
    rel.DICpr2 + theme(legend.position = "none"),
    rel.DICres2 + theme(legend.position = "none"),
    ncol = 1,
    align = "hv"),
  plot_grid(
    get_legend(rel.DICf2),
    ggplot(),
    get_legend(rel.DICpr2),
    ggplot(),
    get_legend(rel.DICres2),
    ggplot(),
    ncol = 1),
  ncol = 3,
  rel_heights = c(1, 32),
  rel_widths = c(6, 6, 1)
)
```

### Same as above, TA
```{r}
rel.TApr <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = rel.TApr), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = rel.TApr), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔTA.bio") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Surface") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold"))

rel.TAres <- ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = rel.TAres), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = rel.TAres), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔTA.res") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Surface TA_residual [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

rel.TApr2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = rel.TApr), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = rel.TApr), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔTA.bio") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold"))

rel.TAres2 <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = rel.TAres), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = rel.TAres), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 1),
                       colours = parula(100),
                       aesthetics = c("fill", "colour"),
                       name = "% ΔTA.res") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Bottom TA_residual [Oct]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

theme_set(theme_minimal())

plot_grid(
  plot_grid(
    get_title(rel.TApr)),
  plot_grid(
    get_title(rel.TApr2)),
  plot_grid(
    ggplot()),
  plot_grid(
    rel.TApr + theme(plot.title = element_blank(), legend.position = "none"),
    rel.TAres + theme(legend.position = "none"),
    ncol = 1,
    align = "hv",
    labels = c("A", "B", "C", "D")),
  plot_grid(
    rel.TApr2 + theme(plot.title = element_blank(), legend.position = "none"),
    rel.TAres2 + theme(legend.position = "none"),
    ncol = 1,
    align = "hv"),
  plot_grid(
    get_legend(rel.TApr2),
    ggplot(),
    get_legend(rel.TAres2),
    ggplot(),
    ncol = 1),
  ncol = 3,
  rel_heights = c(1, 32),
  rel_widths = c(6, 6, 1)
)
```

## "excess" plots
```{r}
# dDIC.ex: 2-40, dTA.ex: 13-88, ratio: 1-9

dDIC.ex <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dDIC.ex), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dDIC.ex), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 40),
                       colours = parula(100),
#                       breaks = c(-40, -20, 0, 20, 40),
                       aesthetics = c("fill", "colour"),
                       name = "ΔDIC ex") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "Bottom") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold"))

dTA.ex <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = dTA.ex), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = dTA.ex), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 88),
                       colours = parula(100),
#                       breaks = c(-30, -15, 0, 15, 30),
                       aesthetics = c("fill", "colour"),
                       name = "ΔTA ex") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Surface delta TA [May]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

ratio <- ggplot() +
  geom_sf(data = bottom_sf_v2, aes(fill = ratio), size = 0.25, colour = NA) +
  geom_sf(data = bottom_sf3, aes(col = ratio), size = 6, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_gradientn(limits = c(0, 9),
                       colours = parula(100),
#                       breaks = c(-20, -10, 0, 10, 20),
                       aesthetics = c("fill", "colour"),
                       name = "Ratio") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  #labs(title = "Surface delta DO [May]") +
  theme_bw() +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.title = element_text(face = "bold"))

theme_set(theme_minimal())

plot_grid(
    dDIC.ex,
    dTA.ex,
    ratio,
    nrow = 3,
    align = "hv",
    labels = c("A", "B", "C"))
```













## percent EM plots
```{r}
ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = a1), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf_3, aes(col = a1), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_fill_distiller(limits = c(0, 1), palette = "YlGnBu",
                       aesthetics = c("fill", "colour"),
                       name = "EM1") +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "% EM1 [Oct]") +
  theme_bw()
```

## MLD bathymetric plots
```{r}
library(marmap)

bathy <- getNOAA.bathy(lon1 = -71, lon2 = -65, lat1 = 39, lat2 = 43, resolution = 1)

# flat map
library(oce)
library(ocedata)
data("coastlineWorldFine")

# convert bathymetry
bathyLon = as.numeric(rownames(bathy))
bathyLat = as.numeric(colnames(bathy))
bathyZ = as.numeric(bathy)
dim(bathyZ) = dim(bathy)

# plot coastline (no projection)
plot(coastlineWorldFine, clon = mean(c(-66, -70.5)), clat = mean(c(40, 42.5)), span = 400)

# plot bathymetry
contour(bathyLon, bathyLat, bathyZ,
        levels = c(-25, -50, -75, -100, -200),
        lty = c(3, 1, 2, 1, 1),
        lwd = c(1, 1, 1, 1.5, 0.5),
        drawlabels = FALSE, add = TRUE, col = 'darkgray')

# add depth legend
legend("bottomright", seg.len = 3, cex = 0.75,
       legend = c("25", "50", "75", "100", "200"),
       lty = c(3, 1, 2, 1, 1),
       lwd = c(1, 1, 1, 1.5, 0.5),
       col = "darkgray", title = "Depth (m)", bg = "white")

# add map data (MLD)
pal <- viridis(n = 112, option = "viridis", direction = -1)
MLD_col <- pal[as.numeric(cut(oct$MLD[which(oct$Cast == "Surface")], breaks = 111))]
points(x = oct$Long[which(oct$Cast == "Surface")],
       y = oct$Lat[which(oct$Cast == "Surface")],
       pch = 18,
       cex = 2,
       col = MLD_col)

# add color legend (MLD)
legend("right", seg.len = 3, cex = 0.75,
       legend = c("10", "20", "30", "40", "50", "60", "70"),
       pch = 18, pt.cex = 1.5,
       col = viridis(n = 7, option = "viridis", direction = -1),
       title = "MLD (m)", bg = "white")

###

# add map data (MLD %)
pal <- viridis(n = 112, option = "viridis", direction = -1)
MLD_col <- pal[as.numeric(cut(oct$MLD_frac[which(oct$Cast == "Surface")], breaks = 111))]
points(x = oct$Long[which(oct$Cast == "Surface")],
       y = oct$Lat[which(oct$Cast == "Surface")],
       pch = 18,
       cex = 2,
       col = MLD_col)

# add color legend (MLD %)
legend("right", seg.len = 3, cex = 0.75,
       legend = c("1", "0.8", "0.6", "0.4", "0.2", "0"),
       pch = 18, pt.cex = 1.5,
       col = viridis(n = 6, option = "viridis", direction = 1),
       title = "MLD %", bg = "white")

###

# add map data (depth)
pal <- viridis(n = 112, option = "viridis", direction = 1)
depth_col <- pal[as.numeric(cut(oct$Depth[which(oct$Cast == "Surface")], breaks = 111))]
points(x = oct$Long[which(oct$Cast == "Surface")],
       y = oct$Lat[which(oct$Cast == "Surface")],
       pch = 18,
       cex = 2,
       col = depth_col)

# add color legend (depth)
legend("right", seg.len = 3, cex = 0.75,
       legend = c("20", "40", "60", "80", "100", "120"),
       pch = 18, pt.cex = 1.5,
       col = viridis(n = 6, option = "viridis", direction = -1),
       title = "MLD (m)", bg = "white")
```

## Prior attempts
```{r}
bathy_full <- getNOAA.bathy(lon1 = -71, lon2 = -65, lat1 = 39, lat2 = 43, resolution = 1)

bathy <- bathy_full %>%
  fortify() %>%
  filter(z < 1) %>%   # remove positive topology
  group_by(z) %>%
  filter(n() >= 4) %>%   # remove depths without min 4 points for a polygon
  ungroup()

ggplot() +
  geom_sf(data = surface_sf_v2, aes(fill = MLD_frac), size = 0.25, colour = NA) +
  geom_sf(data = surface_sf3, aes(col = MLD_frac), size = 8, shape = 18) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  #geom_contour(data = bathy, aes(x = x, y = y, z = z), col = "grey40", size = 0.2) +
  lightness(scale_fill_distiller(palette = "BuGn", direction = "horizontal",
                       aesthetics = c("fill", "colour")),
            scalefac(0.90)) +
  scale_y_continuous(breaks = c(40, 41, 42)) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16)) +
  labs(title = "MLD as % Depth [Oct]") +
  theme_bw() +
  theme(plot.title = element_text(face = "bold", hjust = 0.5),
        legend.title = element_text(face = "bold"))

poly_list <- split(bathy, bathy$z)
poly_list <- lapply(poly_list, function(x) {x["z"] <- NULL; x})
ps <- sapply(poly_list, Polygon)
p1 <- lapply(seq_along(ps), function(i) Polygons(list(ps[[i]]),
                                                 ID = names(poly_list)[i]))
sps <- SpatialPolygons(p1, proj4string = CRS("+init=epsg:4326"))
spdf <- SpatialPolygonsDataFrame(sps, data.frame(id = unique(bathy$z),
                                                 row.names = unique(bathy$z)))

#poly_list <- list()
#poly_data <- data.frame(matrix(ncol = 1, nrow = 0))
#colnames(poly_data) <- "z"

#for(i in 1:nrow(bathy)) {
#  z = bathy$z[i]
#  if(any(poly_data$z==z)) {
#   next
#  }
#  p = Polygon(bathy[bathy$z==z, 1:2])
#  poly_list[[length(poly_list) + 1]] <- p
#  poly_data[nrow(poly_data) + 1, ] <- z
#}

# n_distinct(bathy$z) # 3795 # woohoo! it matches my poly list!

#ps <- lapply(poly_list, Polygon)
#sps = SpatialPolygons(list(ps))


bathy_sf <- st_as_sf(spdf) %>%
  st_transform(crs = 26919) %>%
  filter(id == -40)

ggplot() +
  geom_sf(data = bathy_sf) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  geom_sf(data = b40, size = 0.2) +
  coord_sf(xlim = c(371957.88, 746508.34), ylim = c(4428833.79, 4709654.16))
```












## Check mapping
```{r}
ggplot(bottom_sf, aes(x = Long, y = Lat)) +
  geom_point(aes(colour = Salinity)) +
  geom_text(aes(label = Station), hjust = 0.05, vjust = 0.05, size = 3) +
  #geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_colour_viridis() +
  coord_cartesian(xlim = c(-70.5, -66), ylim = c(40, 42.5)) +
  scale_y_continuous(breaks = c(40, 41, 42))
```

## Check polygon join
```{r}
ggplot() +
  geom_sf(data = GB_sf, fill = "lightblue", size = 0.5)
```

## Check point placement on polygon
```{r}
ggplot() +
  geom_sf(data = GB_sf, fill = NA, size = 0.5) +
  geom_point(data = bottom_sf, aes(x = Long, y = Lat, colour = OmegaAragonite)) +
  geom_text(data = bottom_sf, aes(x = Long, y = Lat, label = Station),
            hjust = -0.05, vjust = 0.05, size = 3) +
  geom_sf(data = mass, fill = "darkgrey", colour = NA) +
  scale_colour_viridis() +
  coord_sf(xlim = c(-70.5, -66), ylim = c(40, 42.5), crs = st_crs(4326)) +
  scale_y_continuous(breaks = c(40, 41, 42))
```
