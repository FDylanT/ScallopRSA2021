---
title: "QC_Check"
author: "Dylan Titmuss"
date: "1/25/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load packages
```{r}
library(tidyverse)
```

## Load RSA data
```{r}
setwd("~/Desktop/Repos/ScallopRSA2021")

may <- read.csv("./data/MayCruiseData.csv") %>%
  rename(Lat = Latitude_degrees_start,
         Long = Longitude_degrees_start,
         Depth = Depth_m_CTD,
         Temp = Temperature) %>%
  select(Station, Cast, Lat, Long, Depth, Temp, Salinity, DIC, TA) %>%
  mutate(Station = as.character(f_pad_zero(Station))) # add leading zeros to station numbers
```

## Convert coordinates
```{r}
chd <- substr(may$Lat, 3, 3)[1]

# convert latitude from DM to DD
Lat_split_may <- str_split_fixed(may$Lat, chd, 2) %>%
  as.data.frame()
Lat_split_may$V2 <- str_remove_all(Lat_split_may$V2, pattern = "'") %>%
  as.numeric()
Lat_split_may$V2 <- Lat_split_may$V2/60
Lat_split_may$V1 <- as.numeric(Lat_split_may$V1)

may$Lat <- Lat_split_may$V1 + Lat_split_may$V2

# convert longitude from DM to DD
Long_split_may <- str_split_fixed(may$Long, chd, 2) %>%
  as.data.frame()
Long_split_may$V2 <- str_remove_all(Long_split_may$V2, pattern = "'") %>%
  as.numeric()
Long_split_may$V2 <- Long_split_may$V2/60
Long_split_may$V1 <- as.numeric(Long_split_may$V1)

may$Long <- -(Long_split_may$V1 + Long_split_may$V2)
```

## Set region bounds
```{r}
minLat <- min(may$Lat) - 0.5
maxLat <- max(may$Lat) + 0.5
minLon <- min(may$Long) - 0.5
maxLon <- max(may$Long) + 0.5
```

## Load QC data
```{r}
QC <- read.csv("./data/bottle_data_DIC_prepared.csv") %>%
  filter(!is.na(TALK),
         Latitude >= minLat,
         Latitude <= maxLat,
         Longitude >= minLon,
         Longitude <= maxLon)
```

## Prop-prop plots
```{r}
ggplot() +
  geom_point(data = may, aes(x = DIC, y = TA, shape = "May 2021 cruise")) +
  geom_point(data = oct, aes(x = DIC, y = TA, shape = "Oct 2021 cruise")) +
  geom_point(data = QC, aes(x = DIC, y = TALK, shape = "historical data")) +
  scale_shape_manual(values = c(1, 15, 17), name = "Data Source") +
  theme_bw() +
  theme(legend.title = element_text(face = "bold"),
        legend.position = c(0.9, 0.1))

ggplot(chem, aes(x = Salinity, y = Temp, col = CTD_depth, shape = Cast)) +
  geom_point() +
  scale_colour_viridis(option = "rocket", direction = -1) +
  theme_bw()

ggplot(chem, aes(x = Salinity, y = DIC_avg, shape = Cast)) +
  geom_point() +
  theme_bw()

ggplot(chem, aes(x = DIC_avg, y = TA_avg, shape = Cast)) +
  geom_point() +
  theme_bw()
```






## Load QC data - NOT THIS
```{r}
QC <- read.csv("./data/bottle_satellite_data_clean.csv") %>%
  filter(Month == 4 | Month == 5) %>%
  filter(Latitude > 40 & Latitude < 42.5) %>%
  filter(Longitude < -66 & Longitude > -70) %>%
  select(Date, Latitude, Longitude, Depth_bottom, Depth, Salinity, Temperature,
         Oxygen, DIC, TA, bottom_depth) %>%
  rename(Lat = Latitude,
         Long = Longitude,
         Temp = Temperature) %>%
  mutate(Depth_ratio = ifelse(!is.na(Depth_bottom), Depth / Depth_bottom, Depth / bottom_depth)) %>%
  mutate(Cast = ifelse(Depth_ratio < 0.07, "Surface",
                       ifelse(Depth_ratio > 0.80, "Bottom", NA)))

QC$Cast[5] <- "Surface"
```
